##TODO get navigation config from pageType document

#if("$!celldoc" != '')
#set($contentDoc = $celldoc)
#else   
#set($contentDoc = $tdoc)
#end
#set($ptConfig = $services.pageType.getPageTypeConfig("$page_type"))
#if("$!page_type" != 'StructuredDataEditor')
  #set($overwritePresCmCssClass = '')
  #set($overwriteNavCMcssClass = 'cel_cm_structured_data_editor_element')
  #set($emptyDictKeySuffix = '_strucured_data_editor')
  #if("$!structDataEditorPresentationCount" == '')
    #set($structDataEditorPresentationCount = 0)
  #end
  #set($structDataEditorNav = $services.treeNode.getJavaNavigation("StructuredDataEditor"))
  #set($structDataEditorSpaceRef = $structDataEditorNav.getNodeSpaceRef())
  ##TODO move editor layout space computation out of Navigation Configuration!!!
  #set($structDataEditorSpace = $structDataEditorSpaceRef.getName())
  #set($structCmCssClass = $structDataEditorNav.getCssClass())
  <!--
DEBUG: $ptConfig.name
DEBUG structDataEditorNav: ${structDataEditorNav}
DEBUG structCmCssClass: ${structCmCssClass}
DEBUG structDataEditorSpace: ${structDataEditorSpace} , $structDataEditorSpace.getClass()
-->
  #set($structDataEditorPresentationCount = $structDataEditorPresentationCount + 1)
  <div id="GP$!{structDataEditorPresentationCount}$!{contentDoc.getName()}:$!{structDataEditorSpace}:" class="structDataEditor $!{structCmCssClass}">
##    #set($injectedNavigationObject = $structDataEditorNav)
##    #parse('celTemplates/PresentationView.vm')
#if($services.layout.canRenderLayout($structDataEditorSpaceRef))
#set($layoutApi = $services.layout.getPageLayoutApiForRef($structDataEditorSpaceRef))
#if($layoutApi.isEditorLayoutType())
$services.layout.renderPageLayout($structDataEditorSpaceRef)
#else
<p>Wrong Editor Layout Type (${layoutApi.getLayoutType()}) for '${structDataEditorSpace}'!</p>
#end
#else
<p>Editor Layout for '${structDataEditorSpace}' is missing!</p>
#end
  </div>
#else
  <p>
    Please create a page-type with View-Template: '$ptConfig.getRenderTemplateForRenderMode('view')'
  </p>
#end