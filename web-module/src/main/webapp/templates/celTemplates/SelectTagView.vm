<!-- SelectTagView -->
## tries to render option-tags from XWiki ListClass
## NOTE we cannot simply use XWiki's displayEdit here because it also renders the select-tag around it
#set($cellDocRef = $celldoc.getDocumentReference())
#set($supportedClasses = ['BooleanClass','ListClass','StaticListClass','DBListClass','DBTreeListClass','UsersClass','GroupsClass','LevelsClass'])
#set($supportedDisplayTypes = ['select','yesno','active'])
#set($propClass = $services.structuredDataEditor.getCellPropertyClass($cellDocRef).orNull())
#set($renderedContent = $services.celementsweb.renderDocument($cellDocRef))
#if("$!renderedContent" != '')
  $renderedContent
#elseif("$!propClass" == '')
  <!-- WARN SelectTagView: no edit field defined on cell: $!celldoc -->
#elseif(!$supportedClasses.contains($propClass.getType()))
  <!-- WARN SelectTagView: doesn't support edit field class: $!propClass.getType() -->
#elseif(!$supportedDisplayTypes.contains($propClass.getProperty('displayType').getValue()))
  <!-- WARN SelectTagView: doesn't support display type: $!propClass.getProperty('displayType').getValue() -->
#else
  #set($isMultiselect = $services.structuredDataEditor.isSelectMultiselect($cellDocRef))
  #if($isMultiselect)
    #set($currentValues = $services.structuredDataEditor.getCellListValue($cellDocRef))
  #else
    #set($currentValues = [$services.structuredDataEditor.getCellValueAsString($cellDocRef)])
  #end
  #set($possibleValues = [])
  #if($propClass.getType().equals('BooleanClass'))
    #set($textMap = {'0': "$!adminMsg.cel_no", '1': "$!adminMsg.cel_yes"})
    #set($stfu = $possibleValues.addAll($textMap.keySet()))
  #else
    #set($stfu = $possibleValues.addAll($propClass.getListValues()))
    #set($textMap = $propClass.getMapValues())
    #foreach($key in $textMap.keySet())
      #set($stfu = $textMap.put($key, $textMap.get($key).getValue()))
    #end
  #end
  #foreach($value in $currentValues)
    #if(!$possibleValues.contains($value))
      #set($stfu = $possibleValues.add($value))
    #end    
  #end
  #foreach($value in $possibleValues)
    #set($valueNoSpaces = $value.replaceAll(" ", "-"))
    #set($dictKey = "$!services.structuredDataEditor.getAttributeName($cellDocRef)_$!valueNoSpaces")
    #set($text = $adminMsg.get($dictKey))
    #if("$!text" == "$!dictKey")
      #if($isSuperAdmin)<!-- missing dict key: $!dictKey -->#end
      #set($text = $textMap.get($value))
    #end
    <option value="$!xwiki.getFormEncoded($value)" #if($currentValues.contains($value)) selected #end>
    #if("$!text" != "")$!{text}#else$!{value}#end
    </option>
  #end
#end
